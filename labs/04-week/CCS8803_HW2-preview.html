<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
    <meta charset="utf-8">
    <meta name="generator" content="quarto-1.6.39">

    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


    <title>Questions â€“ Seismic Monitoring CO2 Storage</title>
    <style>
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      div.columns{display: flex; gap: min(4vw, 1.5em);}
      div.column{flex: auto; overflow-x: auto;}
      div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
      ul.task-list{list-style: none;}
      ul.task-list li input[type="checkbox"] {
        width: 0.8em;
        margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
        vertical-align: middle;
      }
      /* CSS for syntax highlighting */
      pre > code.sourceCode { white-space: pre; position: relative; }
      pre > code.sourceCode > span { line-height: 1.25; }
      pre > code.sourceCode > span:empty { height: 1.2em; }
      .sourceCode { overflow: visible; }
      code.sourceCode > span { color: inherit; text-decoration: inherit; }
      div.sourceCode { margin: 1em 0; }
      pre.sourceCode { margin: 0; }
      @media screen {
      div.sourceCode { overflow: auto; }
      }
      @media print {
      pre > code.sourceCode { white-space: pre-wrap; }
      pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
      }
      pre.numberSource code
        { counter-reset: source-line 0; }
      pre.numberSource code > span
        { position: relative; left: -4em; counter-increment: source-line; }
      pre.numberSource code > span > a:first-child::before
        { content: counter(source-line);
          position: relative; left: -1em; text-align: right; vertical-align: baseline;
          border: none; display: inline-block;
          -webkit-touch-callout: none; -webkit-user-select: none;
          -khtml-user-select: none; -moz-user-select: none;
          -ms-user-select: none; user-select: none;
          padding: 0 4px; width: 4em;
        }
      pre.numberSource { margin-left: 3em;  padding-left: 4px; }
      div.sourceCode
        {   }
      @media screen {
      pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
      }
    </style>

    <style>
      body.hypothesis-enabled #quarto-embed-header {
        padding-right: 36px;
      }

      #quarto-embed-header {
        height: 3em;
        width: 100%;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: solid 1px;
      }

      #quarto-embed-header h6 {
        font-size: 1.1em;
        padding-top: 0.6em;
        margin-left: 1em;
        margin-right: 1em;
        font-weight: 400;
      }

      #quarto-embed-header a.quarto-back-link,
      #quarto-embed-header a.quarto-download-embed {
        font-size: 0.8em;
        margin-top: 1em;
        margin-bottom: 1em;
        margin-left: 1em;
        margin-right: 1em;
      }

      .quarto-back-container {
        padding-left: 0.5em;
        display: flex;
      }

      .headroom {
          will-change: transform;
          transition: transform 200ms linear;
      }

      .headroom--pinned {
          transform: translateY(0%);
      }

      .headroom--unpinned {
          transform: translateY(-100%);
      }      
    </style>

    <script>
    window.document.addEventListener("DOMContentLoaded", function () {

      var header = window.document.querySelector("#quarto-embed-header");
      const titleBannerEl = window.document.querySelector("body > #title-block-header");
      if (titleBannerEl) {
        titleBannerEl.style.paddingTop = header.clientHeight + "px";
      }
      const contentEl = window.document.getElementById('quarto-content');
      for (const child of contentEl.children) {
        child.style.paddingTop = header.clientHeight + "px";
        child.style.marginTop = "1em";
      }

      // Use the article root if the `back` call doesn't work. This isn't perfect
      // but should typically work
      window.quartoBackToArticle = () => {
        var currentUrl = window.location.href;
        window.history.back();
        setTimeout(() => {
            // if location was not changed in 100 ms, then there is no history back
            if(currentUrl === window.location.href){              
                // redirect to site root
                window.location.href = '/';
            }
        }, 100);
      }

      const headroom = new window.Headroom(header, {
        tolerance: 5,
        onPin: function () {
        },
        onUnpin: function () {
        },
      });
      headroom.init();
    });
    </script>

    
<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-e26003cea8cd680ca0c55a263523d882.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-278f079c28f28dbf8752571db94a6592.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
     <script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>  
      </head>

  <body class="nav-sidebar docked quarto-notebook">
    <div id="quarto-embed-header" class="headroom fixed-top bg-primary">
      
      <a onclick="window.quartoBackToArticle(); return false;" class="btn btn-primary quarto-back-link"><i class="bi bi-caret-left"></i> Back to Article</a>
      <h6><i class="bi bi-journal-code"></i> CCS8803_HW2.ipynb</h6>

            <a href="../../labs/04-week/CCS8803_HW2.ipynb" class="btn btn-primary quarto-download-embed" download="CCS8803_HW2.ipynb">Download Notebook</a>
          </div>

     <div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Questions</li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-center sidebar-header">
      <a href="../../index.html" class="sidebar-logo-link">
      <img src="../../images/digitaltwin.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
      <div class="sidebar-tools-main">
    <a href="https://flexie.github.io/EAS-4803-8803-CCS/" title="GitHub" class="quarto-navigation-tool px-1" aria-label="GitHub"><i class="bi bi-github"></i></a>
</div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Home</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../syllabus.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Syllabus</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../goals.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Goals</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../schedule.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Schedule</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docker.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Docker</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../project.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Project</span></a>
  </div>
</li>
    </ul>
    </div>
    
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">      <header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Questions</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>   <div class="cell-container"><div class="cell-decorator"><pre>In [6]:</pre></div><div id="cell-1" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The packages necessary for running the code below</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">PyPlot</span>, <span class="bu">LinearAlgebra</span>, <span class="bu">JLD2</span>, <span class="bu">Polynomials</span>, <span class="bu">JutulDarcyRules</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [7]:</pre></div><div id="cell-2" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># For the first time, run this cell twice to download data and then load the data</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="fu">~isfile</span>(<span class="st">"BGCompass_tti.jld2"</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">run</span>(<span class="ss">`wget -q -O BGCompass_tti.jld2 "https://www.dropbox.com/scl/fi/gs0eh2ldv9til0r7cg27n/BGCompass_tti.jld2?rlkey=bs2sil1ljiztl5bytlqghcm82&amp;st=s5dnrjoh&amp;dl=1"`</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    JLD2.<span class="pp">@load</span> <span class="st">"BGCompass_tti.jld2"</span> m d</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<pre><code>2-element Vector{Symbol}:
 :m
 :d</code></pre>
</div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [8]:</pre></div><div id="cell-3" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Some necessary type conversions and defining size of velocity</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>v <span class="op">=</span> <span class="fu">Float64</span>.(<span class="fu">sqrt</span>.(<span class="fl">1f0</span><span class="op">./</span>m));</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>d <span class="op">=</span> <span class="fu">Float64</span>.(d);</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>n <span class="op">=</span> <span class="fu">size</span>(v)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<pre><code>(325, 171)</code></pre>
</div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [9]:</pre></div><div id="cell-4" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># A basic function to find water bottom layer index values (You do not need to modify this)</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">find_water_bottom</span>(m<span class="op">::</span><span class="dt">AbstractArray{avDT,2}</span>;eps <span class="op">=</span> <span class="fl">1e-4</span>) <span class="kw">where</span> {avDT}</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># return the indices of the water bottom of a seismic image</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    n <span class="op">=</span> <span class="fu">size</span>(m)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    idx <span class="op">=</span> <span class="fu">zeros</span>(<span class="dt">Integer</span>, n[<span class="fl">1</span>])</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> j<span class="op">=</span><span class="fl">1</span><span class="op">:</span>n[<span class="fl">1</span>]</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>        k<span class="op">=</span><span class="fl">1</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> <span class="cn">true</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="fu">abs</span>(m[j,k]) <span class="op">&gt;</span> eps</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>                idx[j] <span class="op">=</span> k</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>                <span class="cf">break</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>            <span class="cf">end</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>            k <span class="op">+=</span> <span class="fl">1</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">end</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> idx</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Changing velocity model to permeability</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">VtoK</span>(v<span class="op">::</span><span class="dt">Matrix{T}</span>, d<span class="op">::</span><span class="dt">Tuple{T, T}</span>; Î±<span class="op">::</span><span class="dt">T</span>=<span class="fu">T</span>(<span class="fl">10</span>)) <span class="kw">where</span> T</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>    n <span class="op">=</span> <span class="fu">size</span>(v)</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>    idx_wb <span class="op">=</span> <span class="fu">find_water_bottom</span>(v<span class="op">.-</span><span class="fu">minimum</span>(v))</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>    idx_ucfmt <span class="op">=</span> <span class="fu">find_water_bottom</span>((v<span class="op">.-</span><span class="fu">T</span>(<span class="fl">3.5</span>))<span class="op">.*</span>(v<span class="op">.&gt;</span><span class="fu">T</span>(<span class="fl">3.5</span>)))</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>    Kh <span class="op">=</span> <span class="fu">zeros</span>(T, n)</span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>    capgrid <span class="op">=</span> <span class="fu">Int</span>(<span class="fu">round</span>(<span class="fu">T</span>(<span class="fl">50</span>)<span class="op">/</span>d[<span class="fl">2</span>]))</span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="op">=</span> <span class="fl">1</span><span class="op">:</span>n[<span class="fl">1</span>]</span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>        Kh[i,<span class="fl">1</span><span class="op">:</span>idx_wb[i]<span class="op">-</span><span class="fl">1</span>] <span class="op">.=</span> <span class="fu">T</span>(<span class="fl">1e-10</span>)  <span class="co"># water layer</span></span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>        Kh[i,idx_wb[i]<span class="op">:</span>idx_ucfmt[i]<span class="op">-</span>capgrid<span class="op">-</span><span class="fl">1</span>] <span class="op">.=</span> <span class="fu">Î±*exp</span>.(v[i,idx_wb[i]<span class="op">:</span>idx_ucfmt[i]<span class="op">-</span>capgrid<span class="op">-</span><span class="fl">1</span>])</span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>        Kh[i,idx_ucfmt[i]<span class="op">-</span>capgrid<span class="op">:</span>idx_ucfmt[i]<span class="op">-</span><span class="fl">1</span>] <span class="op">.=</span> <span class="fu">T</span>(<span class="fl">1e-3</span>)</span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>        Kh[i,idx_ucfmt[i]<span class="op">:</span><span class="kw">end</span>] <span class="op">.=</span> <span class="fu">Î±*exp</span>.(v[i,idx_ucfmt[i]<span class="op">:</span><span class="kw">end</span>]) <span class="op">.-</span> <span class="fu">T</span>(<span class="fl">320</span>)</span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> Kh</span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>Kh <span class="op">=</span> <span class="fu">VtoK</span>(v, d);</span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a><span class="co"># This part is used to create priority (You do not need to modify this)</span></span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a>idx_wb <span class="op">=</span> <span class="fu">find_water_bottom</span>(v<span class="op">.-</span><span class="fu">minimum</span>(v));</span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a>idx_ucfmt <span class="op">=</span> <span class="fu">find_water_bottom</span>((v<span class="op">.-</span><span class="fl">3.5</span>)<span class="op">.*</span>(v<span class="op">.&gt;</span><span class="fl">3.5</span>))</span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a>phi <span class="op">=</span> <span class="fu">zeros</span>(<span class="dt">Float64</span>,n)</span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="op">=</span> <span class="fl">1</span><span class="op">:</span>n[<span class="fl">1</span>]</span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> j <span class="op">=</span> <span class="fl">1</span><span class="op">:</span>n[<span class="fl">2</span>]</span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a>        p <span class="op">=</span> <span class="fu">Polynomial</span>([<span class="op">-</span><span class="fl">0.0314</span><span class="op">^</span><span class="fl">2</span><span class="op">*</span>Kh[i,j],<span class="fl">2</span><span class="op">*</span><span class="fl">0.0314</span><span class="op">^</span><span class="fl">2</span><span class="op">*</span>Kh[i,j],<span class="op">-</span><span class="fl">0.0314</span><span class="op">^</span><span class="fl">2</span><span class="op">*</span>Kh[i,j],<span class="fl">1.527</span><span class="op">^</span><span class="fl">2</span>]) </span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a>        phi[i,j] <span class="op">=</span> <span class="fu">minimum</span>(<span class="fu">real</span>(<span class="fu">roots</span>(p)[<span class="fu">findall</span>(<span class="fu">real</span>(<span class="fu">roots</span>(p))<span class="op">.==</span> <span class="fu">roots</span>(p))]))</span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> j <span class="op">=</span> idx_ucfmt[i]<span class="op">:</span>idx_ucfmt[i]<span class="op">+</span><span class="fl">8</span></span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a>        phi[i,idx_ucfmt[i]<span class="op">:</span>idx_ucfmt[i]<span class="op">+</span><span class="fl">8</span>] <span class="op">=</span> <span class="fu">Float64</span>.(<span class="fu">range</span>(<span class="fl">0.056</span>,stop<span class="op">=</span><span class="fl">0.1</span>,length<span class="op">=</span><span class="fl">9</span>))</span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [10]:</pre></div><div id="cell-5" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We will use a subset of permeability model to make simulation faster .</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>Kh <span class="op">=</span> Kh[<span class="fl">151</span><span class="op">:</span><span class="fl">240</span>, <span class="op">:</span>]</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>K <span class="op">=</span> <span class="fu">Float64</span>.(Kh <span class="op">*</span> JutulDarcyRules.md);</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>n <span class="op">=</span> (<span class="fu">size</span>(K,<span class="fl">1</span>), <span class="fl">1</span>, <span class="fu">size</span>(K,<span class="fl">2</span>))</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>d <span class="op">=</span> (d[<span class="fl">1</span>], <span class="fl">50.0</span>, d[<span class="fl">2</span>])</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>phi <span class="op">=</span> phi[<span class="fl">151</span><span class="op">:</span><span class="fl">240</span>, <span class="op">:</span>]</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>phi_m <span class="op">=</span> <span class="fu">convert</span>(<span class="dt">Array</span>{<span class="dt">Float64</span>,<span class="fl">1</span>},<span class="fu">vec</span>(phi));</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>Ï• <span class="op">=</span> phi</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="co"># We set boundary values of porosity to 1e8. This will prevent over pressurization.</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>Ï•[<span class="fl">1</span>,<span class="op">:</span>] <span class="op">.=</span> <span class="fl">1e8</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>Ï•[<span class="op">:</span>,<span class="fl">1</span>] <span class="op">.=</span> <span class="fl">1e8</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>Ï•[<span class="kw">end</span>,<span class="op">:</span>] <span class="op">.=</span> <span class="fl">1e8</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>Ï•[<span class="op">:</span>,<span class="kw">end</span>] <span class="op">.=</span> <span class="fl">1e8</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>Ï• <span class="op">=</span> <span class="fu">convert</span>(<span class="dt">Array</span>{<span class="dt">Float64</span>,<span class="fl">1</span>},<span class="fu">vec</span>(Ï•));</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [11]:</pre></div><div id="cell-6" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot permeability map </span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">imshow</span>(Kh<span class="op">'</span>, extent <span class="op">=</span> [<span class="fl">0</span>, <span class="fu">size</span>(Kh,<span class="fl">1</span>) <span class="op">*</span>d[<span class="fl">1</span>], <span class="fu">size</span>(Kh,<span class="fl">2</span>) <span class="op">*</span>d[<span class="fl">3</span>], <span class="fl">0</span>]); <span class="fu">colorbar</span>(); <span class="fu">xlabel</span>(<span class="st">"Width [m]"</span>); <span class="fu">ylabel</span>(<span class="st">"Depth [m]"</span>); <span class="fu">title</span>(<span class="st">"Permeability in Darcy"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div class="">
<figure class="figure">
<p class=""><img src="CCS8803_HW2_files/figure-html/cell-7-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display" data-execution_count="11">
<pre><code>PyObject Text(0.5, 1.0, 'Permeability in Darcy')</code></pre>
</div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [12]:</pre></div><div id="cell-7" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the model</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> <span class="fu">jutulModel</span>(n, d, Ï•, <span class="fu">K1to3</span>(K))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<pre><code>jutulModel{3, Float64}((90, 1, 171), (12.5, 50.0, 12.5), [1.0e8, 1.0e8, 1.0e8, 1.0e8, 1.0e8, 1.0e8, 1.0e8, 1.0e8, 1.0e8, 1.0e8  â€¦  1.0e8, 1.0e8, 1.0e8, 1.0e8, 1.0e8, 1.0e8, 1.0e8, 1.0e8, 1.0e8, 1.0e8], [9.86923266716013e-26 9.86923266716013e-26 â€¦ 2.436621876880626e-13 2.351440606894287e-13; 9.86923266716013e-26 9.86923266716013e-26 â€¦ 2.436621876880626e-13 2.351440606894287e-13; 9.86923266716013e-26 9.86923266716013e-26 â€¦ 2.436621876880626e-13 2.351440606894287e-13], 0.0)</code></pre>
</div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [13]:</pre></div><div id="cell-8" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># simulation time steppings (30 days between 2 time samples)</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>tstep <span class="op">=</span> <span class="fl">30</span> <span class="op">*</span> <span class="fu">ones</span>(<span class="fl">100</span>) <span class="co"># This corresponds to 3000 days. 30 is dt and 100 is number of time steps. Keep dt small for stability of solution</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>tot_time <span class="op">=</span> <span class="fu">sum</span>(tstep)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="co">## injection &amp; production (source &amp; sink) location</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>inj_loc <span class="op">=</span> (<span class="fl">5</span>, <span class="fl">1</span>, n[<span class="kw">end</span>]<span class="op">-</span><span class="fl">10</span>) <span class="op">.*</span> d</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>prod_loc <span class="op">=</span> (n[<span class="fl">1</span>]<span class="op">-</span><span class="fl">3</span>, <span class="fl">1</span>, n[<span class="kw">end</span>]<span class="op">-</span><span class="fl">10</span>) <span class="op">.*</span> d</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="co"># injectivity is in m^3 per sec</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>irate <span class="op">=</span> <span class="fl">5e-2</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>q <span class="op">=</span> <span class="fu">jutulForce</span>(irate, [inj_loc, prod_loc])</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a><span class="co">## set up modeling operator</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>S <span class="op">=</span> <span class="fu">jutulModeling</span>(model, tstep)</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a><span class="co">## simulation</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>mesh <span class="op">=</span> <span class="fu">CartesianMesh</span>(model)</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a><span class="fu">T</span>(x) <span class="op">=</span> <span class="fu">log</span>.(<span class="fu">KtoTrans</span>(mesh, <span class="fu">K1to3</span>(<span class="fu">exp</span>.(x))))</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>logK <span class="op">=</span> <span class="fu">log</span>.(K)</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a><span class="pp">@time</span> state <span class="op">=</span> <span class="fu">S</span>(<span class="fu">T</span>(logK), q; info_level<span class="op">=</span><span class="fl">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Jutul: Simulating 428 weeks, 4 days as 100 report steps
Step   1/100: Solving start to 4 weeks, 2 days, Î”t = 4 weeks, 2 days 
Step   2/100: Solving 4 weeks, 2 days to 8 weeks, 4 days, Î”t = 4 weeks, 2 days 
Step   3/100: Solving 8 weeks, 4 days to 12 weeks, 6 days, Î”t = 4 weeks, 2 days 
Step   4/100: Solving 12 weeks, 6 days to 17 weeks, 1 day, Î”t = 4 weeks, 2 days 
Step   5/100: Solving 17 weeks, 1 day to 21 weeks, 3 days, Î”t = 4 weeks, 2 days 
Step   6/100: Solving 21 weeks, 3 days to 25 weeks, 5 days, Î”t = 4 weeks, 2 days 
Step   7/100: Solving 25 weeks, 5 days to 30 weeks, Î”t = 4 weeks, 2 days 
Step   8/100: Solving 30 weeks to 34 weeks, 2 days, Î”t = 4 weeks, 2 days 
Step   9/100: Solving 34 weeks, 2 days to 38 weeks, 4 days, Î”t = 4 weeks, 2 days 
Step  10/100: Solving 38 weeks, 4 days to 42 weeks, 6 days, Î”t = 4 weeks, 2 days 
Step  11/100: Solving 42 weeks, 6 days to 47 weeks, 1 day, Î”t = 4 weeks, 2 days 
Step  12/100: Solving 47 weeks, 1 day to 51 weeks, 3 days, Î”t = 4 weeks, 2 days 
Step  13/100: Solving 51 weeks, 3 days to 55 weeks, 5 days, Î”t = 4 weeks, 2 days 
Step  14/100: Solving 55 weeks, 5 days to 60 weeks, Î”t = 4 weeks, 2 days 
Step  15/100: Solving 60 weeks to 64 weeks, 2 days, Î”t = 4 weeks, 2 days 
Step  16/100: Solving 64 weeks, 2 days to 68 weeks, 4 days, Î”t = 4 weeks, 2 days 
Step  17/100: Solving 68 weeks, 4 days to 72 weeks, 6 days, Î”t = 4 weeks, 2 days 
Step  18/100: Solving 72 weeks, 6 days to 77 weeks, 1 day, Î”t = 4 weeks, 2 days 
Step  19/100: Solving 77 weeks, 1 day to 81 weeks, 3 days, Î”t = 4 weeks, 2 days 
Step  20/100: Solving 81 weeks, 3 days to 85 weeks, 5 days, Î”t = 4 weeks, 2 days 
Step  21/100: Solving 85 weeks, 5 days to 90 weeks, Î”t = 4 weeks, 2 days 
Step  22/100: Solving 90 weeks to 94 weeks, 2 days, Î”t = 4 weeks, 2 days 
Step  23/100: Solving 94 weeks, 2 days to 98 weeks, 4 days, Î”t = 4 weeks, 2 days 
Step  24/100: Solving 98 weeks, 4 days to 102 weeks, 6 days, Î”t = 4 weeks, 2 days 
Step  25/100: Solving 102 weeks, 6 days to 107 weeks, 1 day, Î”t = 4 weeks, 2 days 
Step  26/100: Solving 107 weeks, 1 day to 111 weeks, 3 days, Î”t = 4 weeks, 2 days 
Step  27/100: Solving 111 weeks, 3 days to 115 weeks, 5 days, Î”t = 4 weeks, 2 days 
Step  28/100: Solving 115 weeks, 5 days to 120 weeks, Î”t = 4 weeks, 2 days 
Step  29/100: Solving 120 weeks to 124 weeks, 2 days, Î”t = 4 weeks, 2 days 
Step  30/100: Solving 124 weeks, 2 days to 128 weeks, 4 days, Î”t = 4 weeks, 2 days 
Step  31/100: Solving 128 weeks, 4 days to 132 weeks, 6 days, Î”t = 4 weeks, 2 days 
Step  32/100: Solving 132 weeks, 6 days to 137 weeks, 1 day, Î”t = 4 weeks, 2 days 
Step  33/100: Solving 137 weeks, 1 day to 141 weeks, 3 days, Î”t = 4 weeks, 2 days 
Step  34/100: Solving 141 weeks, 3 days to 145 weeks, 5 days, Î”t = 4 weeks, 2 days 
Step  35/100: Solving 145 weeks, 5 days to 150 weeks, Î”t = 4 weeks, 2 days 
Step  36/100: Solving 150 weeks to 154 weeks, 2 days, Î”t = 4 weeks, 2 days 
Step  37/100: Solving 154 weeks, 2 days to 158 weeks, 4 days, Î”t = 4 weeks, 2 days 
Step  38/100: Solving 158 weeks, 4 days to 162 weeks, 6 days, Î”t = 4 weeks, 2 days 
Step  39/100: Solving 162 weeks, 6 days to 167 weeks, 1 day, Î”t = 4 weeks, 2 days 
Step  40/100: Solving 167 weeks, 1 day to 171 weeks, 3 days, Î”t = 4 weeks, 2 days 
Step  41/100: Solving 171 weeks, 3 days to 175 weeks, 5 days, Î”t = 4 weeks, 2 days 
Step  42/100: Solving 175 weeks, 5 days to 180 weeks, Î”t = 4 weeks, 2 days 
Step  43/100: Solving 180 weeks to 184 weeks, 2 days, Î”t = 4 weeks, 2 days 
Step  44/100: Solving 184 weeks, 2 days to 188 weeks, 4 days, Î”t = 4 weeks, 2 days 
Step  45/100: Solving 188 weeks, 4 days to 192 weeks, 6 days, Î”t = 4 weeks, 2 days 
Step  46/100: Solving 192 weeks, 6 days to 197 weeks, 1 day, Î”t = 4 weeks, 2 days 
Step  47/100: Solving 197 weeks, 1 day to 201 weeks, 3 days, Î”t = 4 weeks, 2 days 
Step  48/100: Solving 201 weeks, 3 days to 205 weeks, 5 days, Î”t = 4 weeks, 2 days 
Step  49/100: Solving 205 weeks, 5 days to 210 weeks, Î”t = 4 weeks, 2 days 
Step  50/100: Solving 210 weeks to 214 weeks, 2 days, Î”t = 4 weeks, 2 days 
Step  51/100: Solving 214 weeks, 2 days to 218 weeks, 4 days, Î”t = 4 weeks, 2 days 
Step  52/100: Solving 218 weeks, 4 days to 222 weeks, 6 days, Î”t = 4 weeks, 2 days 
Step  53/100: Solving 222 weeks, 6 days to 227 weeks, 1 day, Î”t = 4 weeks, 2 days 
Step  54/100: Solving 227 weeks, 1 day to 231 weeks, 3 days, Î”t = 4 weeks, 2 days 
Step  55/100: Solving 231 weeks, 3 days to 235 weeks, 5 days, Î”t = 4 weeks, 2 days 
Step  56/100: Solving 235 weeks, 5 days to 240 weeks, Î”t = 4 weeks, 2 days 
Step  57/100: Solving 240 weeks to 244 weeks, 2 days, Î”t = 4 weeks, 2 days 
Step  58/100: Solving 244 weeks, 2 days to 248 weeks, 4 days, Î”t = 4 weeks, 2 days 
Step  59/100: Solving 248 weeks, 4 days to 252 weeks, 6 days, Î”t = 4 weeks, 2 days 
Step  60/100: Solving 252 weeks, 6 days to 257 weeks, 1 day, Î”t = 4 weeks, 2 days 
Step  61/100: Solving 257 weeks, 1 day to 261 weeks, 3 days, Î”t = 4 weeks, 2 days 
Step  62/100: Solving 261 weeks, 3 days to 265 weeks, 5 days, Î”t = 4 weeks, 2 days 
Step  63/100: Solving 265 weeks, 5 days to 270 weeks, Î”t = 4 weeks, 2 days 
Step  64/100: Solving 270 weeks to 274 weeks, 2 days, Î”t = 4 weeks, 2 days 
Step  65/100: Solving 274 weeks, 2 days to 278 weeks, 4 days, Î”t = 4 weeks, 2 days 
Step  66/100: Solving 278 weeks, 4 days to 282 weeks, 6 days, Î”t = 4 weeks, 2 days 
Step  67/100: Solving 282 weeks, 6 days to 287 weeks, 1 day, Î”t = 4 weeks, 2 days 
Step  68/100: Solving 287 weeks, 1 day to 291 weeks, 3 days, Î”t = 4 weeks, 2 days 
Step  69/100: Solving 291 weeks, 3 days to 295 weeks, 5 days, Î”t = 4 weeks, 2 days 
Step  70/100: Solving 295 weeks, 5 days to 300 weeks, Î”t = 4 weeks, 2 days 
Step  71/100: Solving 300 weeks to 304 weeks, 2 days, Î”t = 4 weeks, 2 days 
Step  72/100: Solving 304 weeks, 2 days to 308 weeks, 4 days, Î”t = 4 weeks, 2 days 
Step  73/100: Solving 308 weeks, 4 days to 312 weeks, 6 days, Î”t = 4 weeks, 2 days 
Step  74/100: Solving 312 weeks, 6 days to 317 weeks, 1 day, Î”t = 4 weeks, 2 days 
Step  75/100: Solving 317 weeks, 1 day to 321 weeks, 3 days, Î”t = 4 weeks, 2 days 
Step  76/100: Solving 321 weeks, 3 days to 325 weeks, 5 days, Î”t = 4 weeks, 2 days 
Step  77/100: Solving 325 weeks, 5 days to 330 weeks, Î”t = 4 weeks, 2 days 
Step  78/100: Solving 330 weeks to 334 weeks, 2 days, Î”t = 4 weeks, 2 days 
Step  79/100: Solving 334 weeks, 2 days to 338 weeks, 4 days, Î”t = 4 weeks, 2 days 
Step  80/100: Solving 338 weeks, 4 days to 342 weeks, 6 days, Î”t = 4 weeks, 2 days 
Step  81/100: Solving 342 weeks, 6 days to 347 weeks, 1 day, Î”t = 4 weeks, 2 days 
Step  82/100: Solving 347 weeks, 1 day to 351 weeks, 3 days, Î”t = 4 weeks, 2 days 
Step  83/100: Solving 351 weeks, 3 days to 355 weeks, 5 days, Î”t = 4 weeks, 2 days 
Step  84/100: Solving 355 weeks, 5 days to 360 weeks, Î”t = 4 weeks, 2 days 
Step  85/100: Solving 360 weeks to 364 weeks, 2 days, Î”t = 4 weeks, 2 days 
Step  86/100: Solving 364 weeks, 2 days to 368 weeks, 4 days, Î”t = 4 weeks, 2 days 
Step  87/100: Solving 368 weeks, 4 days to 372 weeks, 6 days, Î”t = 4 weeks, 2 days 
Step  88/100: Solving 372 weeks, 6 days to 377 weeks, 1 day, Î”t = 4 weeks, 2 days 
Step  89/100: Solving 377 weeks, 1 day to 381 weeks, 3 days, Î”t = 4 weeks, 2 days 
Step  90/100: Solving 381 weeks, 3 days to 385 weeks, 5 days, Î”t = 4 weeks, 2 days 
Step  91/100: Solving 385 weeks, 5 days to 390 weeks, Î”t = 4 weeks, 2 days 
Step  92/100: Solving 390 weeks to 394 weeks, 2 days, Î”t = 4 weeks, 2 days 
Step  93/100: Solving 394 weeks, 2 days to 398 weeks, 4 days, Î”t = 4 weeks, 2 days 
Step  94/100: Solving 398 weeks, 4 days to 402 weeks, 6 days, Î”t = 4 weeks, 2 days 
Step  95/100: Solving 402 weeks, 6 days to 407 weeks, 1 day, Î”t = 4 weeks, 2 days 
Step  96/100: Solving 407 weeks, 1 day to 411 weeks, 3 days, Î”t = 4 weeks, 2 days 
Step  97/100: Solving 411 weeks, 3 days to 415 weeks, 5 days, Î”t = 4 weeks, 2 days 
Step  98/100: Solving 415 weeks, 5 days to 420 weeks, Î”t = 4 weeks, 2 days 
Step  99/100: Solving 420 weeks to 424 weeks, 2 days, Î”t = 4 weeks, 2 days 
Step 100/100: Solving 424 weeks, 2 days to 428 weeks, 4 days, Î”t = 4 weeks, 2 days 
Simulation complete: Completed 100 timesteps in 5 minutes, 28 seconds, 391 milliseconds and 467 iterations.
â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
â”‚ Iteration type â”‚  Avg/step â”‚  Avg/ministep â”‚ Time per â”‚    Total â”‚
â”‚                â”‚ 100 steps â”‚ 112 ministeps â”‚       ms â”‚ (wasted) â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Newton         â”‚      4.67 â”‚       4.16964 â”‚ 703.1921 â”‚  467 (0) â”‚
â”‚ Linearization  â”‚      5.79 â”‚       5.16964 â”‚ 567.1688 â”‚  579 (0) â”‚
â”‚ Linear solver  â”‚     12.37 â”‚       11.0446 â”‚ 265.4735 â”‚ 1237 (0) â”‚
â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
â”‚ Timing type    â”‚     Each â”‚   Relative â”‚    Total â”‚
â”‚                â”‚       ms â”‚ Percentage â”‚        s â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Properties     â”‚   7.6169 â”‚     1.08 % â”‚   3.5571 â”‚
â”‚ Equations      â”‚  94.8596 â”‚    16.73 % â”‚  54.9237 â”‚
â”‚ Assembly       â”‚  48.4451 â”‚     8.54 % â”‚  28.0497 â”‚
â”‚ Linear solve   â”‚ 276.8640 â”‚    39.37 % â”‚ 129.2955 â”‚
â”‚ Preconditioner â”‚ 137.7440 â”‚    19.59 % â”‚  64.3265 â”‚
â”‚ Update         â”‚  39.5927 â”‚     5.63 % â”‚  18.4898 â”‚
â”‚ Convergence    â”‚  19.0519 â”‚     3.36 % â”‚  11.0310 â”‚
â”‚ Input/Output   â”‚   4.0826 â”‚     0.14 % â”‚   0.4572 â”‚
â”‚ Other          â”‚  39.1010 â”‚     5.56 % â”‚  18.2602 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Total          â”‚ 703.1921 â”‚   100.00 % â”‚ 328.3907 â”‚
â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
752.044001 seconds (217.33 M allocations: 14.673 GiB, 0.97% gc time, 80.64% compilation time: 4% of which was recompilation)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="13">
<pre><code>3078000-element jutulStates{Float64}:
 0.0
 0.0
 0.0
 0.0
 0.0
 0.0
 0.0
 0.0
 0.0
 0.0
 0.0
 0.0
 0.0
 â‹®
 2.1359426506710764e7
 2.1358564024889007e7
 2.135696962880001e7
 2.135525710614737e7
 2.135422023336592e7
 2.135430011237757e7
 2.135544957914724e7
 2.135648684846326e7
 2.1359060922351018e7
 2.1362910749874525e7
 2.1367560687066786e7
 2.137222020299839e7</code></pre>
</div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [14]:</pre></div><div id="cell-9" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># CO2 saturation snapshots</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">figure</span>(figsize<span class="op">=</span>(<span class="fl">20</span>,<span class="fl">12</span>));</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>obs<span class="op">=</span><span class="fu">Int</span>.(<span class="fu">round</span>.(<span class="fu">range</span>(<span class="fl">1</span>, stop<span class="op">=</span><span class="fl">100</span>, length<span class="op">=</span><span class="fl">9</span>))); <span class="co"># 9 observed time samples</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">9</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">subplot</span>(<span class="fl">3</span>,<span class="fl">3</span>,i)</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">imshow</span>(<span class="fu">reshape</span>(<span class="fu">Saturations</span>(state.states[obs[i]]), n[<span class="fl">1</span>], n[<span class="kw">end</span>])<span class="ch">', extent=(0,(n[1]-1)*d[1],(n[3]-1)*d[3],0); vmin=0, vmax=maximum(Saturations(state.states[end])))</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlabel</span>(<span class="st">"X [m]"</span>);<span class="fu">ylabel</span>(<span class="st">"Depth [m]"</span>);</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">colorbar</span>()</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="fu">suptitle</span>(<span class="st">"CO2 saturation snapshots at approx 333 days interval "</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div class="">
<figure class="figure">
<p class=""><img src="CCS8803_HW2_files/figure-html/cell-10-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display" data-execution_count="14">
<pre><code>PyObject Text(0.5, 0.98, 'CO2 saturation snapshots at approx 333 days interval ')</code></pre>
</div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [15]:</pre></div><div id="cell-10" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>fig<span class="op">=</span><span class="fu">figure</span>(figsize<span class="op">=</span>(<span class="fl">20</span>,<span class="fl">12</span>));</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="co">#Plot Saturation at the end</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="fu">subplot</span>(<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">1</span>);</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="fu">imshow</span>(<span class="fu">reshape</span>(<span class="fu">Saturations</span>(state.states[<span class="kw">end</span>]), n[<span class="fl">1</span>], n[<span class="kw">end</span>])<span class="ch">', extent=(0,(n[1]-1)*d[1],(n[3]-1)*d[3],0); vmin=0, vmax=maximum(Saturations(state.states[end]))); colorbar(); title("Saturation After 3k days")</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="fu">xlabel</span>(<span class="st">"X [km]"</span>);<span class="fu">ylabel</span>(<span class="st">"Depth [km]"</span>);</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="fu">scatter</span>(inj_loc[<span class="fl">1</span>],inj_loc[<span class="fl">3</span>])</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="fu">scatter</span>(prod_loc[<span class="fl">1</span>],inj_loc[<span class="fl">3</span>])</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>([<span class="st">"Injection loc"</span>,<span class="st">"Production loc"</span>])</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a><span class="co">#Plot Pressure at the end</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a><span class="fu">subplot</span>(<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">2</span>);</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a><span class="fu">imshow</span>(<span class="fu">reshape</span>(<span class="fu">Pressure</span>(state.states[<span class="kw">end</span>]), n[<span class="fl">1</span>], n[<span class="kw">end</span>])<span class="ch">', extent=(0,(n[1]-1)*d[1],(n[3]-1)*d[3],0); vmin=0, vmax=maximum(Pressure(state.states[end]))); colorbar(); title("Pressure After 3k days")</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a><span class="fu">xlabel</span>(<span class="st">"X [km]"</span>);<span class="fu">ylabel</span>(<span class="st">"Depth [km]"</span>);</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a><span class="fu">scatter</span>(inj_loc[<span class="fl">1</span>],inj_loc[<span class="fl">3</span>])</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a><span class="fu">scatter</span>(prod_loc[<span class="fl">1</span>],inj_loc[<span class="fl">3</span>])</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>([<span class="st">"Injection loc"</span>,<span class="st">"Production loc"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div class="">
<figure class="figure">
<p class=""><img src="CCS8803_HW2_files/figure-html/cell-11-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display" data-execution_count="15">
<pre><code>PyObject &lt;matplotlib.legend.Legend object at 0x2aac4123e9c0&gt;</code></pre>
</div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [16]:</pre></div><div id="cell-11" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">maximum</span>(<span class="fu">Saturations</span>(state.states[<span class="kw">end</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="16">
<pre><code>0.8984886621298521</code></pre>
</div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [17]:</pre></div><div id="cell-12" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Save saturation and pressure data in JLD2 format</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>JLD2.<span class="pp">@save</span> <span class="st">"example_sat_press.jld2"</span> state</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<div id="cell-13" class="cell markdown">

</div>
<div id="cell-14" class="cell markdown">
<p>Q1) What do you see in the time-varying CO2 saturation snapshots? How do you interpret the movement of CO2? What role does production well playing here? (20 marks)</p>
</div>
<div id="cell-15" class="cell markdown">

</div>
<div id="cell-16" class="cell markdown">
<p>Q2) What role does production well playing here? (20 marks)</p>
</div>
<div id="cell-17" class="cell markdown">

</div>
<div id="cell-18" class="cell markdown">
<p>Q2) The above experiment is for 3k days. Re-run the experiment for different times such as 1k, 2k, 4k, and 5k days. Show saturation and pressure maps for these days. Show total 8 images. (40 marks)</p>
</div>
<div id="cell-19" class="cell markdown">

</div>
<div id="cell-20" class="cell markdown">
<p>Q3) (a) Calculate the amount of CO2 in the reservoir after 300 days of injection. (10 marks)</p>
<p>Q3) (b) Calculate the amount of CO2 in the reservoir at the end of injection. (10 marks)</p>
<p><em>(Hint: sum(state.states[write array index].Saturations.</em>phi_m)<em>prod(model.d))</em></p>
</div>
<div id="cell-22" class="cell markdown">
<p>Q4) Play with the seal region of permeability map to create a fault (very high permeability 500 mD say) in small region of seal. Re-run the experiment to see if CO2 leaks out from the seal. Showing saturation map is enough here. (Bonus 10 point)</p>
</div>
<div id="cell-23" class="cell markdown">

</div>


     </main> <!-- /main -->  <script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "î§‹";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/flexie\.github\.io\/EAS-8803-CCS\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>  </div> <!-- /content --> 
  
</body></html>